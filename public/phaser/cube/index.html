<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.24.1/dist/phaser.min.js"></script>

</head>
<body>
    <script>
var config={
    width:800,
    height:600,
    physics:{
        default:"arcade"
    },
    scene: {
                preload: preload,
                create: create,
                update: update
            }
}
var game=new Phaser.Game(config);
var player;
var items;
var fire;
var lastFired=0;
var keyA;
var keyD;
var bullets;

function preload(){
    this.load.image('player','assets/star.png');
    this.load.image('bomb','assets/bomb.png');
    this.load.image('bullet','assets/bomb.png');

};
function touchbomb(player,item){
        item.disableBody(true,true);
        console.info(config);
        //console.log('you touched the bomb');
    }
function create(){
    player=this.physics.add.image(400,300,'player');
    player.setCollideWorldBounds(true);
    cursors = this.input.keyboard.createCursorKeys();
    fire = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
    keyA = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
    keyD = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);



    items = this.physics.add.group({
                key: "bomb",
                repeat: 1,
                setXY: {
                    x: Phaser.Math.Between(0,800),
                    y: Phaser.Math.Between(0,600),
                }
            });
    this.physics.add.overlap(player, items, touchbomb, null, this);
    // bullet=new Phaser.Class({
    //     initialize:
    //     function Bullet(scene){
    //         new Image(scene,0,0,'bullet');

    //     },
    //     fire:function(player){
    //         this.lifespan=1200;
    //         this.setActive=true;
    //         this.setVisible=true;
    //         this.setAngle(player.body.rotation);
    //         this.setPosition(player.x,player.y);
    //         this.body.reset(player.x,player.y);
    //         var angle=Phaser.Math.DegToRad(player.body.rotation);

    //         this.scene.physics.velocityFromRotation(angle,this.speed,this.body.velocity);
    //     },
    //     update: function (time, delta)
    //     {
    //         this.lifespan -= delta;

    //         if (this.lifespan <= 0)
    //         {
    //             this.setActive(false);
    //             this.setVisible(false);
    //             this.body.stop();
    //         }
    //     }
    // })
    var Bullet = new Phaser.Class({
        Extends: Phaser.Physics.Arcade.Image,
        
        initialize:

        function Bullet (scene){
            Phaser.Physics.Arcade.Image.call(this,scene,0,0,'bullet','bullet');
            
            this.setBlendMode(1);
            this.setDepth(1);

            this.speed=300;
            this.lifespan=1200;

            this._temp= new Phaser.Math.Vector2();
        },
        
        fire: function(player)
        {
        
        this.lifespan=1200;
        
        this.setActive(true);
        this.setVisible(true);
        this.setAngle(player.body.rotation);
        this.setPosition(player.x,player.y);
        this.body.reset(player.x,player.y);
        


        var angle=Phaser.Math.DegToRad(player.body.rotation);

        this.scene.physics.velocityFromRotation(angle,this.speed,this.body.velocity);

        this.body.velocity.x*=1.8;
        this.body.velocity.y*=1.8;
        
        },
        update: function (time, delta)
        {
            this.lifespan -= delta;

            if (this.lifespan <= 0)
            {
                this.setActive(false);
                this.setVisible(false);
                this.body.stop();
            }
        }
    });
    bullets = this.physics.add.group({
        classType: Bullet,
        maxSize: 40,
        runChildUpdate: true
    });
    
};
function update(time,delta){
    player.setVelocityX(0);
    player.setVelocityY(0);
    player.setAcceleration(0);
    player.setAngularVelocity(0);
    if (keyA.isDown){
        player.setAngularVelocity(-250);

    }
    if (keyD.isDown){
        player.setAngularVelocity(250);

    }
    if (cursors.left.isDown){
        player.setVelocityX(-100);
    }
    if (cursors.right.isDown){
        player.setVelocityX(100);

    }
    if (cursors.up.isDown){
        player.setVelocityY(-100);
    }
    if (cursors.down.isDown){
        player.setVelocityY(100);
    }
    if (fire.isDown && time > lastFired)
    {
        var bullet = bullets.get();

        if (bullet)
        {
            bullet.fire(player);

            lastFired = time + 70;
        }
    }
    
};

    </script>
</body>
</html>